
<html>
	<head>
		<title>Stellar'ISEN - planets</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<script src="js/three.js"></script>
		<script src="js/utils.js"></script>
	</head>
	<body>
		<div id="loader-wrapper">
			<img id="loader" src="res/images/planet.png" alt="">
		</div>		
		
		<script>
			var scene = new THREE.Scene();
			let camera = null;
			if (viewportIsPortrait()) {
				let ratio = window.innerWidth / window.innerHeight;
				camera = new THREE.OrthographicCamera( -16.285714285714285 * ratio, 16.285714285714285 * ratio, 16.285714285714285, -16.285714285714285, - 500, 1000); 
				camera.rotation.z = -Math.PI / 2;
			}	
			else {
				let ratio = window.innerHeight / window.innerWidth;
				camera = new THREE.OrthographicCamera( -16.285714285714285, 16.285714285714285, 16.285714285714285 * ratio, -16.285714285714285 * ratio, - 500, 1000); 
			}	
			var renderer = new THREE.WebGLRenderer({ antialias: true });
			
			// On met en place le renderer
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);
			
			let planets = [];
			
			let textures =
				[	"res/images/planets/sun.png"
				,	"res/images/planets/mercury.png"
				,	"res/images/planets/venus.png"
				,	"res/images/planets/earth.png"
				,	"res/images/planets/mars.png"
				,	"res/images/planets/jupiter.png"
				,	"res/images/planets/saturn.png"
				,	"res/images/planets/uranus.png"
				,	"res/images/planets/neptune.png"
				,	"res/images/planets/pluto.png"
				]
			
			let distances = 
				[	-24
				,	-13
				,	-9
				,	-6.7
				,	-4.7
				,	1.5
				,	5.5
				,	9
				,	12
				,	14
				]
				
			let radius =
				[	10
				,	0.38555
				,	0.95623
				,	1.00672
				,	0.5357
				,	1.6
				,	1.4
				,	1.1
				,	1.1
				,	0.18744
				]
				
			let tilts = 
				[	-0.1265364	// Soleil
				,	-0.0005235988	// Mercure
				,	-0.04607669	// Venus
				,	-0.408407	// Terre
				,	-0.43964844	// Mars
				,	-0.05462881 // Jupiter
				,	-0.4660029	// Saturne
				,	-1.4351842	// Uranus
				,	-0.49427724	// Neptune
				,	-1.0030407	// Pluto
				]
				
			let texturesObjects = new Array(10);
			let rings = null;
			let wasPortrait = viewportIsPortrait();
				
			// Le LoadingManager va permettre d'interagir pendant le chargement de gros fichiers
			// et potentiellement d'afficher un loader
			let loadingManager = new THREE.LoadingManager();
			loadingManager.onLoad = () => { 
				for (let index = 0; index < textures.length; index++) {
					let geometry = new THREE.SphereBufferGeometry(radius[index], 50, 50);
					let material = new THREE.MeshBasicMaterial(
						{	transparent: true
						,	color: '#ffffff'
						,	map: texturesObjects[index]
						});
					let planet = new THREE.Mesh(geometry, material);
					planet.position.z = -10;
					planet.position.x = distances[index];
					planet.rotation.z = tilts[index] + (viewportIsPortrait() ? -Math.PI / 2 : 0);
					scene.add(planet);
					planets.push(planet);
				}
				
				let geometry = new THREE.RingBufferGeometry(2.2, 3.2, 25);
				let material = new THREE.MeshBasicMaterial(
					{	color: '#E1C9A2'
					,	side: THREE.DoubleSide
					});
					
				rings = new THREE.Mesh(geometry, material);
				rings.position.z = -10;
				rings.position.x = 5.5;
				rings.rotation.y = Math.PI * 1.45;
				rings.rotateOnWorldAxis(new THREE.Vector3(0, 0, 1), 0.4660029 * 2.33 + (viewportIsPortrait() ? -Math.PI / 2 : 0));
				scene.add(rings);	
				
				/* Activation de l'animation de fade-out du loading */
				const loadingScreen = document.getElementById( 'loader-wrapper' );
				loadingScreen.classList.add( 'fade-out' );
			};
			
			let textureLoader = new THREE.TextureLoader(loadingManager);
			for (let index = 0; index < textures.length; index++) {
				textureLoader.load(textures[index], (texture) => { texturesObjects[index] = texture; })
			}
			
			window.addEventListener('resize', function () {
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth, window.innerHeight);
				if (viewportIsPortrait()) {
					let ratio = window.innerWidth / window.innerHeight;
					camera.left =  -16.285714285714285 * ratio;
					camera.right = 16.285714285714285 * ratio;
					camera.top = 16.285714285714285;
					camera.bottom = -16.285714285714285;
					camera.rotation.z = -Math.PI / 2;
				}	
				else {
					let ratio = window.innerHeight / window.innerWidth;
					camera.left =  -16.285714285714285;
					camera.right = 16.285714285714285;
					camera.top = 16.285714285714285 * ratio;
					camera.bottom = -16.285714285714285 * ratio;
					camera.rotation.z = 0;
				}
					
				if (viewportIsPortrait() != wasPortrait) {
					for (let index = 0; index < planets.length; index++) {
						planets[index].rotateOnWorldAxis(new THREE.Vector3(0, 0, 1), (viewportIsPortrait() ? -Math.PI / 2 : Math.PI / 2));
					}
					rings.rotateOnWorldAxis(new THREE.Vector3(0, 0, 1), (viewportIsPortrait() ? -Math.PI / 2 : Math.PI / 2));
					wasPortrait = viewportIsPortrait();
				}
				
				camera.updateProjectionMatrix();
			});

			var update = () => { 
				requestAnimationFrame(update);
				for (let i = 0; i < planets.length; i++) {
					planets[i].rotateY(0.01);
				}
				renderer.render(scene, camera);
			};
			update();
		</script>
	</body>
</html>
